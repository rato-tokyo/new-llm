# Claude Code Development Guidelines for New-LLM Project

## Code and File Cleanup Policy - CRITICAL

**古いコード・ファイルを残すことは厳禁です (Leaving old code/files is strictly prohibited)**

### 基本原則

新しい実装、バグ修正、ファイル更新を行った際は、**必ず古いバージョンを完全に削除**してください。

### 削除対象

#### 1. 古いコードファイル

- ✗ 使われなくなったメソッド・関数
- ✗ コメントアウトされたコード
- ✗ デバッグ用の一時コード
- ✗ 重複した機能を持つコード
- ✗ 古いバージョンのスクリプト

**例**:
```python
# ✗ 悪い例 - 古いコードをコメントアウトで残す
# def old_function():
#     # 古い実装
#     pass

def new_function():
    # 新しい実装
    pass

# ✓ 良い例 - 古いコードは完全に削除
def new_function():
    # 新しい実装
    pass
```

#### 2. 古い画像・グラフファイル

- ✗ バグのあるグラフ
- ✗ 古い実験結果の画像
- ✗ 修正前のビジュアライゼーション
- ✗ `_old`, `_backup`, `_v1` などの接尾辞がついたファイル

**具体例**:
```bash
# ✗ 悪い例 - 古い画像を残す
checkpoints/
  ├── graph.png              # 新しい
  ├── graph_old.png          # 古い - 削除すべき
  └── graph_backup.png       # バックアップ - 削除すべき

# ✓ 良い例 - 最新版のみ保持
checkpoints/
  └── graph.png              # 新しい版のみ
```

#### 3. 古いチェックポイント・データファイル

- ✗ 古い実験の `.pt` ファイル
- ✗ 使われていないデータファイル
- ✗ 一時的な中間ファイル

### 後方互換性について

**このプロジェクトでは後方互換性を意識しません。**

- ✗ 古いインターフェースを残す必要なし
- ✗ 古いAPIを維持する必要なし
- ✗ 古いファイル名を保持する必要なし

**理由**:
- 研究プロジェクトであり、プロダクションコードではない
- 古いコードが残ると混乱とバグの温床になる
- クリーンな状態を維持することが最優先

### 実行手順

#### ファイル更新時:

1. **新しいファイルを作成**
2. **動作確認**
3. **古いファイルを完全に削除**
4. **コミット時に削除も含める**

```bash
# 例: グラフファイルの更新
python generate_new_graph.py              # 新しいグラフ生成
# 確認: new_graph.png が正しく生成された

rm old_graph.png                          # 古いグラフを削除
git add new_graph.png                     # 新しいファイルを追加
git rm old_graph.png                      # Gitからも削除
git commit -m "Replace graph with fixed version, remove old buggy graph"
```

#### コード更新時:

1. **新しいコードを実装**
2. **テスト**
3. **古いコード（コメントアウト含む）を削除**
4. **未使用のインポートも削除**

### チェックリスト

コミット前に必ず確認：

- [ ] コメントアウトされたコードは削除したか？
- [ ] 未使用のメソッド・関数は削除したか？
- [ ] 古いバージョンのファイルは削除したか？
- [ ] `_old`, `_backup`, `_temp` などの接尾辞のファイルは削除したか？
- [ ] 未使用のインポート文は削除したか？
- [ ] デバッグ用のprint文は削除したか？

### Git操作

古いファイルを削除する際:

```bash
# ファイルシステムとGitの両方から削除
git rm old_file.py

# または
rm old_file.py
git add -A  # 削除も含めてステージング
```

### 例外

**削除してはいけないもの**:

- ✓ `.gitignore` で除外されているファイル（ローカル環境のみ）
- ✓ ドキュメント内の「悪い例」としての参照コード
- ✓ テストケースとして意図的に残している古い動作

### 違反の影響

古いコード・ファイルを残すことで発生する問題：

1. **混乱** - どれが最新版かわからない
2. **バグ** - 古いコードを誤って使用
3. **メンテナンス困難** - 複数バージョンの同期が必要
4. **リポジトリ肥大化** - 不要なファイルでサイズ増加

## 実装後の必須チェックリスト

機能実装・バグ修正後は以下を必ず確認：

- [ ] 古いメソッドやクラスが残っていないか
- [ ] コメントアウトされたコードが残っていないか
- [ ] 古い画像・グラフファイルが残っていないか
- [ ] 使用されていないファイルが残っていないか
- [ ] 重複した機能を持つコードが複数箇所にないか
- [ ] 未使用のインポートが残っていないか
- [ ] デバッグ用のコードが残っていないか

## コミットメッセージ

古いファイルを削除した場合、コミットメッセージに明記：

```bash
git commit -m "Fix graph bug and remove old buggy version

- Fixed: Perplexity plot now uses linear scale
- Removed: old_graph.png (had log scale bug)
- Added: new_graph_fixed.png (correct version)
"
```

## まとめ

**鉄則**:
- ✓ 新しいバージョンを作ったら、古いバージョンは即座に削除
- ✗ 「念のため」残すことは禁止
- ✓ Gitの履歴に残っているので、必要なら復元可能

**徹底的なクリーンアップがプロジェクトの品質を保ちます。**
