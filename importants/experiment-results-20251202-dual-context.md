# Dual Context å®Ÿé¨“çµæœ (2025-12-02)

## æ¦‚è¦

**Dual Context ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: ãƒ‡ãƒ¼ã‚¿ã‚’2åˆ†å‰²ã—ã€å„ContextBlockï¼ˆcd=500ï¼‰ã‚’åˆ¥ã€…ã«å­¦ç¿’ã€Phase 2ã§é€£çµï¼ˆcd=1000ï¼‰ã—ã¦TokenBlockã‚’å­¦ç¿’ã€‚

**ä»®èª¬**: å˜ä¸€ã®cd=1000ã‚ˆã‚Šã€cd=500Ã—2ã®æ–¹ãŒåŠ¹ç‡çš„ã«æ¬¡å…ƒã‚’æ´»ç”¨ã§ãã‚‹ã®ã§ã¯ï¼Ÿ

---

## å®Ÿé¨“è¨­å®š

| é …ç›® | å€¤ |
|------|-----|
| GPU | NVIDIA L4 (22.2GB) |
| Samples | 2000 |
| Train tokens | 2,403,563 |
| Val tokens | 22,723 |
| context_dim per block | 500 |
| Combined context_dim | 1000 |
| num_layers | 1 (C1T1 æ§‹æˆ) |

### ãƒ‡ãƒ¼ã‚¿åˆ†å‰²

- **ContextBlock A**: å‰åŠ 1,201,782 tokens
- **ContextBlock B**: å¾ŒåŠ 1,201,782 tokens

---

## çµæœã‚µãƒãƒªãƒ¼

| æ§‹æˆ | context_dim | Params | P1 Iter | Conv% | ER% | Val PPL | Val Acc | Total Time |
|------|-------------|--------|---------|-------|-----|---------|---------|------------|
| **ğŸ¥‡ Dual (C1T1Ã—2)** | **500Ã—2=1000** | 41.2M | 30+29 | 92%/92% | 73.6% | **111.9** | **25.6%** | 1745s |
| ğŸ¥ˆ C1T1 | 500 | 40.2M | 30 | 92% | 79.7% | 127.2 | 24.7% | ~1200s |
| C2T2 | 500 | 41.8M | 14 | 93% | 79.6% | 132.2 | 24.4% | 730s |
| C1T1 | 1000 | 41.7M | 46 | 82% | 69.3% | 134.0 | 23.6% | 1490s |
| C2T2 | 1000 | 44.9M | 24 | 91% | 73.4% | 137.9 | 24.4% | 992s |

---

## è©³ç´°æ¯”è¼ƒ

### 1. PPLï¼ˆä½ã„ã»ã©è‰¯ã„ï¼‰

| æ§‹æˆ | Val PPL | vs C1T1-500 | vs C1T1-1000 |
|------|---------|-------------|--------------|
| **Dual** | **111.9** | **-12.0%** | **-16.5%** |
| C1T1-500 | 127.2 | - | -5.1% |
| C2T2-500 | 132.2 | +3.9% | -1.3% |
| C1T1-1000 | 134.0 | +5.3% | - |
| C2T2-1000 | 137.9 | +8.4% | +2.9% |

**ğŸ† Dual Context ãŒ PPL ã§åœ§å‹ï¼ˆ-12% vs æ¬¡ç‚¹ï¼‰**

### 2. Accuracyï¼ˆé«˜ã„ã»ã©è‰¯ã„ï¼‰

| æ§‹æˆ | Val Acc | vs C1T1-500 |
|------|---------|-------------|
| **Dual** | **25.6%** | **+0.9%** |
| C1T1-500 | 24.7% | - |
| C2T2-500 | 24.4% | -0.3% |
| C2T2-1000 | 24.4% | -0.3% |
| C1T1-1000 | 23.6% | -1.1% |

**ğŸ† Dual Context ãŒæœ€é«˜ç²¾åº¦**

### 3. Effective Rank

| æ§‹æˆ | å®ŸåŠ¹æ¬¡å…ƒ | ER% |
|------|----------|-----|
| C1T1-500 | ~398/500 | **79.7%** |
| C2T2-500 | ~398/500 | 79.6% |
| **Dual** | **~736/1000** | 73.6% |
| C2T2-1000 | ~734/1000 | 73.4% |
| C1T1-1000 | ~693/1000 | 69.3% |

**è€ƒå¯Ÿ**:
- ER%ã§ã¯cd=500ãŒå„ªä½ã ãŒã€**çµ¶å¯¾çš„ãªå®ŸåŠ¹æ¬¡å…ƒã¯DualãŒæœ€å¤§ï¼ˆ736æ¬¡å…ƒï¼‰**
- Dualã¯1000æ¬¡å…ƒä¸­736æ¬¡å…ƒã‚’æ´»ç”¨ â‰’ å˜ä¸€cd=1000ã‚ˆã‚ŠåŠ¹ç‡çš„

---

## Phase 1 è©³ç´°

### Phase 1A (ContextBlock A)

```
Tokens: 1,201,782 (å‰åŠ)
Iterations: 30
Convergence: 92%
Time: 154.8s
```

### Phase 1B (ContextBlock B)

```
Tokens: 1,201,782 (å¾ŒåŠ)
Iterations: 29
Convergence: 92%
Time: 150.2s
```

**ç‰¹å¾´**: ä¸¡ãƒ–ãƒ­ãƒƒã‚¯ã¨ã‚‚é«˜ã„åæŸç‡ï¼ˆ92%ï¼‰ã‚’é”æˆ

---

## Phase 2 è©³ç´°

```
[Phase 2] 2,403,562 train / 22,722 val tokens, 20 epochs
  Epoch 1: train_ppl=330.5 val_ppl=154.2 acc=23.0% â˜…
  Epoch 2: train_ppl=145.2 val_ppl=128.1 acc=24.3% â˜…
  Epoch 3: train_ppl=118.3 val_ppl=119.7 acc=24.7% â˜…
  Epoch 4: train_ppl=105.6 val_ppl=116.0 acc=25.0% â˜…
  Epoch 5: train_ppl=97.9  val_ppl=114.0 acc=25.2% â˜…
  Epoch 6: train_ppl=92.7  val_ppl=112.9 acc=25.3% â˜…
  Epoch 7: train_ppl=88.9  val_ppl=112.3 acc=25.5% â˜…
  Epoch 8: train_ppl=86.0  val_ppl=111.9 acc=25.6% â˜…
  â†’ Early stop at epoch 8 (PPL improvement 0.37 < 0.4)
  Best: epoch 8, ppl=111.9, acc=25.6%
```

---

## å‡¦ç†æ™‚é–“ã®å†…è¨³

| ãƒ•ã‚§ãƒ¼ã‚º | æ™‚é–“ | å‚™è€ƒ |
|----------|------|------|
| Phase 1A | 154.8s | ContextBlock A å­¦ç¿’ |
| Phase 1B | 150.2s | ContextBlock B å­¦ç¿’ |
| **Phase 2 Prep** | **995.0s** | **ã‚­ãƒ£ãƒƒã‚·ãƒ¥åé›†ï¼ˆãƒœãƒˆãƒ«ãƒãƒƒã‚¯ï¼‰** |
| Phase 2 | 444.6s | TokenBlock å­¦ç¿’ |
| **Total** | **1744.7s** | |

**âš ï¸ ãƒœãƒˆãƒ«ãƒãƒƒã‚¯**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥åé›†ãŒ983ç§’ï¼ˆå…¨ä½“ã®57%ï¼‰
- åŸå› : ã‚·ãƒ¼ã‚±ãƒ³ã‚·ãƒ£ãƒ«å‡¦ç†ï¼ˆ1ãƒˆãƒ¼ã‚¯ãƒ³ãšã¤é †ä¼æ¬ï¼‰
- æ”¹å–„æ¡ˆ: ãƒãƒƒãƒå‡¦ç†åŒ–ã§é«˜é€ŸåŒ–å¯èƒ½

---

## ãªãœ Dual Context ãŒè‰¯ã„ã®ã‹ï¼Ÿ

### 1. ãƒ‡ãƒ¼ã‚¿åˆ†å‰²ã«ã‚ˆã‚‹å°‚é–€åŒ–

```
ContextBlock A: å‰åŠãƒ‡ãƒ¼ã‚¿ã«ç‰¹åŒ–ã—ãŸæ–‡è„ˆè¡¨ç¾ã‚’å­¦ç¿’
ContextBlock B: å¾ŒåŠãƒ‡ãƒ¼ã‚¿ã«ç‰¹åŒ–ã—ãŸæ–‡è„ˆè¡¨ç¾ã‚’å­¦ç¿’
â†’ é€£çµã™ã‚‹ã¨ç›¸è£œçš„ãªæƒ…å ±ã‚’æä¾›
```

### 2. cd=500 ã®åŠ¹ç‡æ€§ã‚’ç¶­æŒ

| æ¯”è¼ƒ | å˜ä¸€cd=1000 | Dual (500Ã—2) |
|------|------------|--------------|
| Phase 1 åæŸ | 82% (46 iter) | 92%Ã—2 (30+29 iter) |
| ER% | 69.3% | 73.6% |
| æ¬¡å…ƒæ´»ç”¨ | éåŠ¹ç‡ | åŠ¹ç‡çš„ |

### 3. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŠ¹ç‡

| æ§‹æˆ | Params | PPL | Params/PPLåŠ¹ç‡ |
|------|--------|-----|----------------|
| **Dual** | 41.2M | **111.9** | **æœ€é«˜åŠ¹ç‡** |
| C1T1-1000 | 41.7M | 134.0 | ä½ã„ |
| C2T2-1000 | 44.9M | 137.9 | æœ€ä½ |

---

## é‡è¦ãªç™ºè¦‹

### âœ… Dual Context ã®å„ªä½æ€§

| æŒ‡æ¨™ | çµæœ | æ”¹å–„ç‡ |
|------|------|--------|
| **Val PPL** | **111.9** | -12% vs C1T1-500 |
| **Val Acc** | **25.6%** | +0.9% vs C1T1-500 |
| å®ŸåŠ¹æ¬¡å…ƒ | 736 | çµ¶å¯¾å€¤ã§æœ€å¤§ |
| Phase 1 åæŸ | 92%Ã—2 | å®‰å®š |

### âš ï¸ ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•

| é …ç›® | Dual | C1T1-500 |
|------|------|----------|
| å‡¦ç†æ™‚é–“ | 1745s | ~1200s |
| å®Ÿè£…è¤‡é›‘åº¦ | é«˜ã„ | ã‚·ãƒ³ãƒ—ãƒ« |
| ãƒ¡ãƒ¢ãƒªä½¿ç”¨ | ã‚„ã‚„å¤šã„ | å°‘ãªã„ |

---

## çµè«–

### ãƒ©ãƒ³ã‚­ãƒ³ã‚°

| é †ä½ | æ§‹æˆ | PPL | Acc | æ¨å¥¨ç”¨é€” |
|------|------|-----|-----|----------|
| **ğŸ¥‡ 1ä½** | **Dual Context** | **111.9** | **25.6%** | **æœ€é«˜ç²¾åº¦ãŒå¿…è¦ãªå ´åˆ** |
| ğŸ¥ˆ 2ä½ | C1T1-500 | 127.2 | 24.7% | ãƒãƒ©ãƒ³ã‚¹é‡è¦– |
| ğŸ¥‰ 3ä½ | C2T2-500 | 132.2 | 24.4% | é€Ÿåº¦é‡è¦– |
| éæ¨å¥¨ | cd=1000 å˜ä½“ | 134+ | 23-24% | ãƒ¡ãƒªãƒƒãƒˆãªã— |

### è¨­è¨ˆæŒ‡é‡

```python
# æœ€é«˜ç²¾åº¦ã‚’ç›®æŒ‡ã™å ´åˆ
architecture = "DualContext"
context_dim_per_block = 500
combined_context_dim = 1000

# ãƒãƒ©ãƒ³ã‚¹é‡è¦–ã®å ´åˆ
architecture = "Standard"
context_dim = 500
num_layers = 1  # C1T1
```

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—å€™è£œ

1. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥åé›†ã®é«˜é€ŸåŒ–**
   - ç¾åœ¨: 983ç§’ï¼ˆã‚·ãƒ¼ã‚±ãƒ³ã‚·ãƒ£ãƒ«ï¼‰
   - ç›®æ¨™: ãƒãƒƒãƒå‡¦ç†ã§200ç§’ä»¥ä¸‹

2. **3åˆ†å‰²å®Ÿé¨“**
   - ContextBlockÃ—3 (cd=333Ã—3=999)
   - ã•ã‚‰ãªã‚‹å°‚é–€åŒ–åŠ¹æœï¼Ÿ

3. **éå¯¾ç§°åˆ†å‰²**
   - 70:30, 80:20 ãªã©ã®åˆ†å‰²æ¯”ç‡
   - æœ€é©ãªåˆ†å‰²ç‚¹ã®æ¢ç´¢

4. **ç•°ãªã‚‹layersæ•°ã®çµ„ã¿åˆã‚ã›**
   - ContextBlock A: 2å±¤, B: 1å±¤ ãªã©

---

*Last Updated: 2025-12-02*
