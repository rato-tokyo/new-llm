# Baseline Verification (2025-11-25)

## 目的

commit 9ee3281の実測値を正確に記録し、今後のベースラインとする。

## 実験設定

- **コミット**: `9ee3281` (Fix Phase 1 training: combine CVFP and diversity losses)
- **データ**: UltraChat 50サンプル (6400トークン訓練 + 1280トークン検証)
- **ハイパーパラメータ**:
  - `dist_reg_weight = 0.5` (CVFP 50%, Diversity 50%)
  - `phase1_learning_rate = 0.002`
  - `phase1_max_iterations = 10`
  - `layernorm_mix = 1.0` (LayerNorm有効)

## 結果

### 訓練データ (6400トークン)

```
Effective Rank: 568.31/768 (74.0%)
Actual Rank: 768/768 (100.0%)
収束率: 30.0% (1923/6400トークン)
最終損失: CVFP=1.135702, Diversity=-0.317315
```

### 検証データ (1280トークン)

```
Effective Rank: 511.56/768 (66.6%)
Actual Rank: 768/768 (100.0%)
収束率: 100.0% (1280/1280トークン)
```

### 3つのクリティカルチェック

1. **Effective Rank (多様性)**: ❌ FAILED
   - 検証: 66.6% (目標: ~85%以上)
   - 訓練: 74.0%

2. **Identity Mapping (恒等写像)**: ✅ PASSED
   - diff = 25.3561 (閾値 > 0.1クリア)
   - 学習が機能している

3. **Convergence Rate (収束率)**: ❌ FAILED
   - 訓練: 20.0% (期待: >50%)
   - 検証: 100.0% (良好)

## 重要な発見

### 1. 89.4%記載は誤りだった

- **以前の記載**: "検証データで89.4% Effective Rank達成"
- **実測値**: **66.6% Effective Rank**
- **差異**: -22.8% (大幅な乖離)

### 2. 正しいベースライン

この**66.6% / 74.0%**が正しいベースラインであり、今後の改善はこの数値を基準に評価する。

### 3. NaN問題の有無

- ✅ このコミットではNaN問題は発生しない
- ✅ 全10イテレーション正常完了
- ✅ 損失値は有限値を保つ

## 並列化実験の前提

この66.6%をベースラインとして、以下の並列化実験を実施する：

1. **シーケンシャル版** (現行): 66.6% ER達成済み
2. **並列版** (実験): ERの低下を最小限に抑えつつ高速化を目指す

### 実験目標

- **速度**: 3x以上の高速化
- **Effective Rank**: 60%以上を維持（ベースラインから-6.6%以内）
- **許容範囲**: ±10%のER変動

## 次のステップ

1. ✅ ドキュメント更新完了（CLAUDE.md）
2. 🔄 並列化実験実施（`test_parallel_comparison.py`）
3. ⏳ 結果分析と判定

---

**Last Updated**: 2025-11-25
**Commit**: 9ee3281
**Status**: Baseline Verified
