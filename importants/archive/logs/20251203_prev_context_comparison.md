# prev_context_steps 比較実験

**Date**: 2025-12-03
**構成**: 2 ContextBlocks
**比較**: p=0, p=1, p=2

---

## 構成比較まとめ

| 構成 | combined_dim | 1600 PPL | PPL_min | ER% |
|------|--------------|----------|---------|-----|
| p=0 | 512 | 127.4 | **95.4** | 78% |
| p=1 | 1024 | 118.2 | ~85-90 | 73% |
| **p=2** | **1536** | **114.7** | **87.3** | 71% |

**重要**: prev_context_stepsを増やすと**理論限界値自体が改善**する。

---

## p=1（1つ前のcontext）

| Samples | Val PPL | Val Acc | ER% |
|---------|---------|---------|-----|
| 200 | 246.5 | 21.0% | 72.8% |
| 400 | 178.6 | 22.8% | 73.1% |
| 800 | 142.5 | 24.1% | 72.7% |
| **1600** | **118.2** | **25.3%** | **72.5%** |

---

## p=2（2つ前までのcontext）

| Samples | Val PPL | Val Acc | ER% |
|---------|---------|---------|-----|
| 200 | 256.0 | 21.0% | 70.7% |
| 400 | 178.7 | 22.9% | 70.8% |
| 800 | 142.4 | 24.6% | 70.4% |
| **1600** | **114.7** | **25.7%** | **70.9%** |

### 飽和モデルフィッティング（p=2）

```
PPL = 87.3 + 14990 × n^(-0.847)

PPL_min = 87.3
R² = 0.9985
AIC = 11.70
```

---

## 改善率

| 比較 | PPL改善 | PPL_min改善 |
|------|---------|-------------|
| p=0 → p=1 | -7.2% | ~-10% |
| p=1 → p=2 | -3.0% | 改善小 |
| **p=0 → p=2** | **-10.0%** | **-8.5%** |

---

## 推奨

- **コスパ重視**: p=1（combined_dim=1024）
- **精度重視**: p=2（combined_dim=1536、PPL_min=87.3）

---

## 注意: interval=1のみ有効

interval=8などの大きな間隔は効果なし（悪化）。
→ 詳細は `20251203_prev_context_interval8_count2.md` を参照。

---

*統合元: 20251203_2block_prev1_sample_search.md, 20251203_2block_p2_sample_search.md*
