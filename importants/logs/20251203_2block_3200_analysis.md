# 2-Block (p=0) 3200サンプル実験 - スケーリングモデル判定

**Date**: 2025-12-03
**構成**: 2 ContextBlocks (p=0)
**combined_dim**: 512

## 実験結果 (5点)

| Samples | Tokens | Val PPL | Val Acc | ER% |
|---------|--------|---------|---------|-----|
| 200 | 240,132 | 258.3 | 20.5% | 78.0% |
| 400 | 473,429 | 187.6 | 22.0% | 78.4% |
| 800 | 948,524 | 150.5 | 23.5% | 77.2% |
| 1600 | 1,920,992 | 127.4 | 24.5% | 78.1% |
| **3200** | **3,864,746** | **114.8** | **25.0%** | **77.9%** |

## スケーリングモデル比較

### AICによるモデル選択

| Rank | Model | AIC | PPL_min | R² |
|------|-------|-----|---------|-----|
| **1** | **Saturation** | **7.12** | **95.4** | **0.999530** |
| 2 | Exp Decay | 11.83 | 109.7 | 0.999193 |
| 3 | Power Law | 26.65 | N/A | 0.965217 |

### 各モデルの式

1. **Saturation (最良)**: `PPL = 95.4 + 10000 × n^(-0.778)`
2. **Exp Decay**: `PPL = 109.7 + 5000 × exp(-1.03 × n^0.23)`
3. **Power Law**: `PPL = 1360 × n^(-0.32)`

### 予測精度

| Samples | Actual | Saturation | Exp Decay | Power Law |
|---------|--------|------------|-----------|-----------|
| 200 | 258.3 | 257.1 (-0.5%) | 257.6 (-0.3%) | 248.6 (-3.8%) |
| 400 | 187.6 | 189.7 (+1.1%) | 189.8 (+1.2%) | 199.0 (+6.1%) |
| 800 | 150.5 | 150.3 (-0.1%) | 148.7 (-1.2%) | 159.4 (+5.9%) |
| 1600 | 127.4 | 127.4 (+0.0%) | 126.5 (-0.7%) | 127.6 (+0.1%) |
| **3200** | **114.8** | **114.0 (-0.7%)** | 115.9 (+1.0%) | 102.2 (-11.0%) |

## 4点データでの予測検証

3200サンプルの実績値 (114.8) と、4点のみでフィッティングした場合の予測を比較：

| Model | 4点での予測 | 実績 | 誤差 |
|-------|-----------|------|------|
| **Saturation** | **113.4** | **114.8** | **-1.2%** |
| Exp Decay | 119.2 | 114.8 | +3.8% |

**飽和モデルの方が3200サンプルの実績をより正確に予測**した。

## 結論

### 1. 飽和モデルが最も適合

- **AIC最小** (7.12 vs 11.83)
- **R²最高** (0.9995)
- **外挿精度も良好** (4点→3200予測で誤差-1.2%)

### 2. 理論限界値

| Model | PPL_min |
|-------|---------|
| **Saturation** | **95.4** |
| Exp Decay | 109.7 |

**飽和モデルによるPPL_min = 95.4が最も信頼できる推定値**

### 3. 外挿予測 (飽和モデル)

| Samples | 予測 PPL |
|---------|---------|
| 6,400 | ~107 |
| 12,800 | ~101 |
| ∞ | 95.4 |

### 4. 今後の方針

現在のPPL (114.8) と PPL_min (95.4) の差は **19.4**。
さらなる改善のためには：

- **サンプル数増加**: 6400+ サンプルで ~107 に到達可能
- **アーキテクチャ改善**: prev_context_steps=1 などで限界値自体を下げる
- **3-block, 4-block**: ブロック数増加による表現力向上

## 比較: p=0 vs p=1 (1600サンプル時点)

| 構成 | 1600 samples PPL | PPL_min (Saturation) |
|------|------------------|----------------------|
| 2-block (p=0) | 127.4 | 95.4 |
| 2-block (p=1) | 118.2 | ~85-90 (推定) |

prev_context_steps=1 の方が限界値が低い可能性が高い。
